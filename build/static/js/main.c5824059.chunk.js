(this["webpackJsonpmy-webpack-project"]=this["webpackJsonpmy-webpack-project"]||[]).push([[0],{110:function(e,t,a){},152:function(e,t,a){},153:function(e,t,a){},154:function(e,t,a){},160:function(e,t,a){},162:function(e,t,a){},163:function(e,t,a){},164:function(e,t,a){"use strict";a.r(t);var r=a(4),n=a(6),s=a(7),i=a(8),c=a(14),o=a(224),l=a(0),u=a.n(l),d=a(23),h=a.n(d),j=a(17),p=a(221),f=a(216),b=a(206),m=a(165),g=a(34),x=g.a.initializeApp({apiKey:"AIzaSyAhKNoLSbI082LfD08uTtt67fzuc3fDgzo",authDomain:"ruffmix-app.firebaseapp.com",databaseURL:"https://ruffmix-app-default-rtdb.firebaseio.com",projectId:"ruffmix-app",storageBucket:"ruffmix-app.appspot.com",messagingSenderId:"721486047256",appId:"1:721486047256:web:1487b9fc61c34d0a7efb6d"});x.database().useEmulator("192.168.1.246",9e3),x.auth().useEmulator("http://192.168.1.246:9099"),x.storage().useEmulator("192.168.1.246",9199);var v=g.a,O=a(205),y=a(213),D=a(220),k=a(204),C=a(215),S=a(65),w=a.n(S),I=(a(152),a(30)),P=a(92),M=a(214),U=a(233),N=a(230),R=a(168),T=a(166),A=a(124),L=a.n(A),z=a(227),E=a(169),F=a(207),W=a(226),_=a(212),B=a(231),V=a(232),G=a(208),J=a(209),q=a(210),H=a(211),$=(a(153),a(200)),Y=a(198),K=a(122),X=a.n(K),Q=a(123),Z=a.n(Q),ee=a(120),te=a.n(ee),ae=a(99),re=a.n(ae),ne=a(100),se=a.n(ne),ie=a(121),ce=a.n(ie),oe=a(111),le=a.n(oe),ue=a(112),de=a.n(ue),he=a(113),je=a.n(he),pe=a(114),fe=a.n(pe),be=a(22),me=a(70),ge=a(196),xe=a(199),ve=a(201),Oe=a(202),ye=a(203),De=a(228),ke=(a(154),a(2)),Ce=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleFileSelect=function(e){n.fileInput.current.files[0]!==n.state.audioFile&&n.setState({audioFile:n.fileInput.current.files[0]},(function(){return n.drawPreview(n.fileInput.current.files[0])})),e.preventDefault()},n.handleChange=function(e){if(e.target.name.match("Mixing|Mastering|Arrangement")){var t=Object(me.a)(n.state.trackMetaData),a=parseInt(e.target.id);e.target.checked?t[a]=e.target.name:t[a]="",n.setState({trackMetaData:t})}else n.setState(Object(I.a)(Object(I.a)({},n.state),{},Object(be.a)({},e.target.name,e.target.value)),(function(){if(e.target.name.match("metaDataOther")){var t=Object(me.a)(n.state.trackMetaData);t[3]=n.state.metaDataOther,n.setState({trackMetaData:t})}}))},n.handleTrackSubmit=function(e){var t="";n.props.newVersionFolder?t=n.props.newVersionFolder:t=v.database().ref().push().key;var a=v.database().ref().push().key,r=n.fileInput.current.files[0],s=v.storage().ref().child(n.state.userID+"/audio/"+t+"/"+a);n.props.router.setLoadingState(!0),v.database().ref("users/"+n.state.userID+"/audio/"+t+"/"+a).set({folderID:t,trackID:a,userID:n.state.userID,trackname:n.state.trackName,description:n.state.trackDescription,metadata:n.state.trackMetaData,commentdata:n.state.trackCommentData}).catch((function(e){alert("Track Data Set fail"+e)})),s.put(r).then((function(e){console.log("File upload success"),n.props.router.updateContent(Object(ke.jsx)(Me,{router:n.props.router,user:n.props.router.getUserID()}))})).then((function(){return n.props.router.setLoadingState(!1)})).catch((function(e){alert("Track Upload fail"+e)})),e.preventDefault()},n.drawPreview=function(e){var t=Object(ke.jsx)(Pe,{isChild:!1,preview:!0,controller:Object(j.a)(n),router:n.props.router,audiofile:e,trackname:n.state.trackName,metadata:[],description:""});n.setState({trackPreviewPlayer:""},(function(){return n.setState({trackPreviewPlayer:t})}))},n.state={trackName:"",trackDescription:"",trackCommentData:[""],trackMetaData:["","","",""],userID:n.props.router.getUserID(),audioFile:"",metaDataOther:"",other:!1,trackPreviewPlayer:"",loadingProgress:0},n.handleChange=n.handleChange.bind(Object(j.a)(n)),n.handleTrackSubmit=n.handleTrackSubmit.bind(Object(j.a)(n)),n.handleFileSelect=n.handleFileSelect.bind(Object(j.a)(n)),n.showLoadingProgress=n.showLoadingProgress.bind(Object(j.a)(n)),n.fileInput=u.a.createRef(),n.previewRef=u.a.createRef(),n}return Object(n.a)(a,[{key:"showLoadingProgress",value:function(e){this.setState({loadingProgress:e})}},{key:"render",value:function(){var e=this;return Object(ke.jsx)(m.a,{in:!0,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[Object(ke.jsx)(ge.a,{title:this.props.newVersionFolder?"Upload New Track Version":"Upload New Track"}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",children:[Object(ke.jsx)(Y.a,{in:this.state.trackPreviewPlayer,display:"flex",flexDirection:"column",justifyContent:"flex-start",children:Object(ke.jsx)(z.a,{height:"64px",pb:7,children:this.state.trackPreviewPlayer})}),Object(ke.jsx)("form",{onSubmit:this.handleTrackSubmit,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",alignItems:"center",className:this.props.router.getStyles("formContent"),children:[Object(ke.jsxs)(xe.a,{children:[Object(ke.jsx)($.a,{title:"Upload your music file - Supported formats: .mp3, .wav, .aac, .m4a, .flac",arrow:!0,placement:"right",children:Object(ke.jsx)(ve.a,{type:"file",inputProps:{ref:this.fileInput,accept:"audio/flac, audio/m4a, audio/wav, audio/mp3, audio/aac"},required:!0,onChange:this.handleFileSelect,startAdornment:Object(ke.jsx)(Oe.a,{children:Object(ke.jsx)(w.a,{})})})}),Object(ke.jsx)($.a,{title:"The title of your track",arrow:!0,placement:"right",children:Object(ke.jsx)(W.a,{label:"Track Name",name:"trackName",placeholder:". . .",size:"medium",required:!0,value:this.state.trackName,onChange:this.handleChange})}),Object(ke.jsx)($.a,{title:"A description of your track",arrow:!0,placement:"right",children:Object(ke.jsx)(W.a,{label:"Description",name:"trackDescription",placeholder:". . .",size:"medium",value:this.state.trackDescription,onChange:this.handleChange})}),Object(ke.jsx)($.a,{title:"What problem areas do you want feedback on, or what have you been working on?",arrow:!0,placement:"right",children:Object(ke.jsxs)("div",{children:[Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"0",name:"Mixing",onChange:this.handleChange}),label:"Mixing"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"1",name:"Mastering",onChange:this.handleChange}),label:"Mastering"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"2",name:"Arrangement",onChange:this.handleChange}),label:"Arrangement"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{name:"other",onClick:function(){e.setState({other:!e.state.other})}}),label:"Other"}),Object(ke.jsxs)(Y.a,{in:!!this.state.other,display:"flex",flexDirection:"column",children:[Object(ke.jsx)("div",{children:'Please specify "Other" tag (Limit 12 characters):'}),Object(ke.jsx)(W.a,{name:"metaDataOther",placeholder:". . .",size:"medium",inputProps:{maxLength:12},value:this.state.metaDataOther,onChange:this.handleChange})]})]})})]}),Object(ke.jsx)(O.a,{type:"submit",variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),children:"Upload Track"})]})})]}),Object(ke.jsx)(z.a,{})]})})}}]),a}(u.a.Component);a(160);function Se(e){var t="";""!==e.commentArray&&(t=e.commentArray.map((function(t){if(""!==t)return Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",justifyContent:t.author===e.router.getUserID()?"flex-end":"flex-start",children:Object(ke.jsx)(Ue,{router:e.router,userID:t.author,comment:t.body,player:e.player})})})));return Object(ke.jsx)("div",{children:t})}function we(e){var t=Object(l.useRef)(),a=Object(l.useRef)(),r=e.isChild?64:96;return Object(l.useEffect)((function(){if(t.current){var n=le.a.create({container:t.current,height:r,progressColor:"lightgrey",waveColor:"lightgreen",responsive:"true",plugins:[fe.a.create({container:a.current,height:r,timeInterval:7.5}),de.a.create({showTime:"true",opacity:"1"}),je.a.create({regionsMinLength:2})]});!1===e.asPreview&&n.enableDragSelection({color:"hsla(400, 100%, 30%, 0.1)",id:"dragSelection"}),n.on("ready",(function(){return e.handleReady(n)})),n.on("seek",(function(){return e.setTime()})),n.on("loading",(function(t){return e.setLoadingProgress(t)})),n.on("region-mouseenter",(function(t){t.id.substring(t.id.indexOf("[")+1,t.id.indexOf("]"));var a=t.id.substring(t.id.indexOf("_")+1,t.id.length),r=g.a.database().ref("users/"+a+"/displayname"),n="";r.on("value",(function(e){n=e.val()}));var s={xPos:0,user:n};t.on("mouseenter",(function(t){s.xPos=t.pageX,e.identifier(s)}))}));var s=g.a.storage().ref();e.audiofile&&(e.audiofile instanceof File?n.loadBlob(e.audiofile):s.child(e.audiofile).getDownloadURL().then((function(e){var t=new XMLHttpRequest;t.responseType="blob",t.onload=function(e){t.response},t.open("GET",e),t.send(),n.load(e)})).catch((function(e){alert("Waveform download error: "+e)})))}}),[]),Object(ke.jsxs)("div",{children:[Object(ke.jsx)(z.a,{position:"relative",zIndex:"5",ref:t}),Object(ke.jsx)("div",{style:{opacity:"20%",marginTop:-r,pointerEvents:"none"},ref:a})]})}function Ie(e){if(e.array){var t=e.array,a=["#FFAB91","#CE93D8","#80CBC4","#FFE082"];return t.map((function(e,t){if(""!==e)return Object(ke.jsx)(z.a,{mx:.5,children:Object(ke.jsx)(B.a,{style:{backgroundColor:a[t]},size:"small",label:e})})}))}}var Pe=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleTextChange=function(e){n.setState({commentContent:e.target.value}),n.previewRegion(),n.checkRegions(),e.preventDefault()},n.handleCommentSubmit=function(e){if(e.preventDefault(),n.state.commentContent){n.state.expand||n.toggleExpand();var t={author:n.props.router.getUserID(),body:n.state.commentContent},a=[];0===n.state.commentArr.length?a[0]=t:a=n.state.commentArr.concat(t),g.a.database().ref("users/"+n.state.userID+"/audio/"+n.state.folderID+"/"+n.state.trackID).update({commentdata:a}),n.setState({commentContent:"",inputTime:""},(function(){return n.drawExistingRegions()}))}},n.state={playState:!1,expand:!1,isChild:n.props.isChild,trackIsPreview:!!n.props.preview&&n.props.preview,commentArr:[],commentContent:"",playerObject:"",playerDuration:"",currentTime:"",controller:n.props.controller,containsPreviews:!1,audioFile:n.props.audiofile,trackName:n.props.trackname,metaData:n.props.metadata,description:n.props.description,folderID:n.props.folderID,trackID:n.props.trackID,userID:n.props.userID,loadingProgress:0,regionIdentifier:"",authorControls:n.props.userID===n.props.router.getUserID()},n.handleReady=n.handleReady.bind(Object(j.a)(n)),n.setTime=n.setTime.bind(Object(j.a)(n)),n.setLoadingProgress=n.setLoadingProgress.bind(Object(j.a)(n)),n.setRegionIdentifier=n.setRegionIdentifier.bind(Object(j.a)(n)),n}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=g.a.database().ref("users/"+this.state.userID+"/audio/"+this.state.folderID+"/"+this.state.trackID),a="";t.on("value",(function(t){(a=t.val())&&e.setState({commentArr:a.commentdata})}))}},{key:"componentWillUnmount",value:function(){this.stopPlay()}},{key:"newTrackVersion",value:function(){this.props.router.getUserID()&&this.state.authorControls?this.props.router.updateContent(Object(ke.jsx)(Ce,{router:this.props.router,newVersionFolder:this.state.folderID})):this.login()}},{key:"deleteTrack",value:function(){var e=this;this.state.authorControls&&(this.props.router.setLoadingState(!0),g.a.database().ref("users/"+this.state.userID+"/audio/"+this.state.folderID+"/"+this.state.trackID).remove().then((function(){console.log("Deleted track from realtime DB")})).catch((function(e){alert("Realtime DB track delete error: "+e)})),g.a.storage().ref().child("audio/"+this.state.folderID+"/"+this.state.trackID).delete().then((function(){console.log("Deleted track from storage"),e.state.controller.getTracks()})).then((function(){return e.props.router.setLoadingState(!1)})).catch((function(e){alert("Storage track delete error: "+e)})))}},{key:"clearPreviewRegions",value:function(){if(this.state.playerObject){var e=this.state.playerObject.regions.list;Object.keys(e).forEach((function(t){e[t].id.includes("preview")&&e[t].remove()}))}}},{key:"drawExistingRegions",value:function(){var e=this;if(this.state.playerObject){this.state.playerObject.clearRegions();var t=this.state.commentArr,a=0;t.forEach((function(t){if(t){var r=new RegExp("^\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d\\s|^\\d\\:\\d\\d\\-\\d\\:\\d\\d\\s| \\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d|\\d\\:\\d\\d\\-\\d\\:\\d\\d |\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d$|\\d\\:\\d\\d\\-\\d\\:\\d\\d$|^\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d$|^\\d\\:\\d\\d\\-\\d\\:\\d\\d$","g"),n=JSON.stringify(t.body).match(r);n&&n.forEach((function(r){var n=r.split("-",2),s=n[0],i=n[1],c=s.split(":"),o=60*c[0]+1*c[1],l=i.split(":"),u=60*l[0]+1*l[1],d=e.state.playerObject.getDuration();o>=0&&u>=0&&o<=d&&u<=d&&e.state.playerObject.addRegion({id:"["+a+"]"+Math.random().toString().substring(2,8)+"_"+t.author,start:o,end:u,resize:!1,drag:!1,color:"hsla(200, 50%, 70%, 0.4)"})})),a++}}))}this.checkRegions()}},{key:"previewRegion",value:function(){var e=this;this.clearPreviewRegions();var t=new RegExp("^\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d\\s|^\\d\\:\\d\\d\\-\\d\\:\\d\\d\\s| \\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d|\\d\\:\\d\\d\\-\\d\\:\\d\\d |\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d$|\\d\\:\\d\\d\\-\\d\\:\\d\\d$|^\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d$|^\\d\\:\\d\\d\\-\\d\\:\\d\\d$","g"),a=this.state.commentContent.match(t);a&&a.forEach((function(t){var a=t.split("-",2),r=a[0],n=a[1],s=r.split(":"),i=60*s[0]+1*s[1],c=n.split(":"),o=60*c[0]+1*c[1],l=e.state.playerObject.getDuration();if(i>=0&&o>=0&&i<=l&&o<=l){var u=e.state.playerObject.regions.list;if(u){var d=0,h=!1;Object.keys(u).forEach((function(e){d++,u[e].start===i&&u[e].end===o&&u[e].id.includes("preview")&&(h=!0)})),h||e.state.playerObject.addRegion({id:"preview "+d,start:i,end:o,resize:!1,color:"hsla(400, 100%, 30%, 0.1)"})}}}))}},{key:"checkRegions",value:function(){var e=this.state.playerObject.regions.list,t=this.state.commentContent,a=!1;Object.keys(e).forEach((function(r){var n=e[r].start,s=e[r].end,i=new Date(1e3*n).toISOString().substr(15,4),c=new Date(1e3*s).toISOString().substr(15,4);e[r].id.includes("preview")&&(a=!0),e[r].id.includes("preview")&&!t.includes(i+"-"+c)&&e[r].remove()})),this.setState({containsPreviews:a})}},{key:"getSeconds",value:function(e){var t=e.split(":"),a=t[0],r=t[1];return parseInt(60*a)+parseInt(r)}},{key:"setLoadingProgress",value:function(e){this.setState({loadingProgress:e})}},{key:"setTime",value:function(){var e=this;this.setState({currentTime:new Date(1e3*this.state.playerObject.getCurrentTime()).toISOString().substr(11,8),playState:!0},(function(){return e.togglePlay(e.state.playerObject.getCurrentTime())}))}},{key:"setRegionIdentifier",value:function(e){this.setState({regionIdentifier:e})}},{key:"handleReady",value:function(e){var t=this,a=new Date(1e3*e.getDuration()).toISOString().substr(11,8);this.setState({playerObject:e,playerDuration:a,currentTime:new Date(1e3*e.getCurrentTime()).toISOString().substr(11,8)}),this.state.trackIsPreview||(this.state.playerObject.on("region-update-end",(function(e){if("dragSelection"===e.id){var a=e.start,r=e.end,n=new Date(1e3*a).toISOString().substr(15,4),s=new Date(1e3*r).toISOString().substr(15,4),i=t.state.commentContent.concat(n+"-"+s+" ");t.setState({commentContent:i}),e.remove(),t.previewRegion(),t.checkRegions()}})),this.checkRegions(),this.drawExistingRegions()),this.state.playerObject.on("pause",(function(){!1!==t.state.playState&&t.setState({playState:!t.state.playState})}))}},{key:"stopPlay",value:function(){this.state.playerObject&&(this.setState({playState:!1}),this.state.playerObject.pause())}},{key:"playFrom",value:function(e){var t=e.split("-"),a=this.getSeconds(t[0]),r=this.getSeconds(t[1]);this.togglePlay(a,r)}},{key:"togglePlay",value:function(e,t){this.state.playerObject&&(e?this.state.playerObject.play(e):e&&t?this.state.playerObject.play(e,t):this.state.playerObject.playPause(),e||t?this.setState({playState:!0}):this.setState({playState:!this.state.playState}),!this.state.trackIsPreview&&this.state.controller&&(""===this.state.controller.getPrevPlayer()?this.state.controller.setPrevPlayer(this):this!==this.state.controller.getPrevPlayer()&&(this.state.controller.getPrevPlayer().stopPlay(),this.state.controller.setPrevPlayer(this))))}},{key:"toggleExpand",value:function(){this.setState({expand:!this.state.expand})}},{key:"render",value:function(){var e=this;return this.state.trackIsPreview?Object(ke.jsxs)(z.a,{children:[Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",alignItems:"center",children:[Object(ke.jsx)(k.a,{onClick:function(){e.togglePlay()},size:"small",edge:"start",style:{marginRight:"5px"},children:this.state.playState?Object(ke.jsx)(re.a,{style:{width:"64px",height:"64px"}}):Object(ke.jsx)(se.a,{style:{width:"64px",height:"64px"}})}),Object(ke.jsx)(z.a,{width:"400px",children:Object(ke.jsx)(we,{isChild:!1,playState:this.state.playState,handleReady:this.handleReady,setTime:this.setTime,audiofile:this.state.audioFile,setLoadingProgress:this.setLoadingProgress})})]}),Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",justifyContent:"center",children:Object(ke.jsx)(Ie,{array:this.state.metaData})})]}):Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",padding:"10px",children:[Object(ke.jsx)(z.a,{style:{display:this.state.isChild?"flex":"none"},paddingLeft:"70%",margin:"10px",children:Object(ke.jsx)(te.a,{style:{color:"lightgrey"},fontSize:"small"})}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",justifyContent:"flex-start",paddingLeft:"20%",style:{display:this.state.isChild?"none":"true"},children:[this.state.trackName+" - "+this.state.description,Object(ke.jsx)(R.a,{style:{position:"fixed",left:this.state.regionIdentifier.xPos},children:this.state.regionIdentifier.user})]}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",children:[Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",style:{visibility:this.state.authorControls?"visible":"hidden",zIndex:"2"},children:[Object(ke.jsx)($.a,{title:"Upload a new version of this track",placement:"left",arrow:!0,children:Object(ke.jsx)(k.a,{onClick:function(){return e.newTrackVersion()},style:{display:this.state.isChild?"none":"true"},children:Object(ke.jsx)(ce.a,{style:{transform:"scaleY(-1)"}})})}),Object(ke.jsx)($.a,{title:"Delete this track",placement:"left",arrow:!0,children:Object(ke.jsx)(k.a,{onClick:function(){return e.deleteTrack()},children:Object(ke.jsx)(X.a,{})})})]}),Object(ke.jsx)(k.a,{onClick:function(){e.togglePlay()},size:"small",edge:"start",style:{marginRight:"5px"},children:this.state.playState?Object(ke.jsx)(re.a,{style:{width:this.state.isChild?"48px":"64px",height:this.state.isChild?"48px":"64px"}}):Object(ke.jsx)(se.a,{style:{width:this.state.isChild?"48px":"64px",height:this.state.isChild?"48px":"64px"}})}),Object(ke.jsx)(z.a,{width:this.state.isChild?"60%":"80%",children:Object(ke.jsxs)("div",{children:[Object(ke.jsx)(z.a,{style:{display:100===this.state.loadingProgress?"none":"true"},display:"flex",justifyContent:"center",children:Object(ke.jsx)(b.a,{})}),Object(ke.jsx)("div",{style:{visibility:100===this.state.loadingProgress?"visible":"hidden"},children:Object(ke.jsx)(we,{isChild:this.state.isChild,playState:this.state.playState,handleReady:this.handleReady,setTime:this.setTime,audiofile:this.props.audiofile,setLoadingProgress:this.setLoadingProgress,asPreview:this.state.trackIsPreview,identifier:this.setRegionIdentifier})})]})})]}),Object(ke.jsxs)(z.a,{marginTop:"-3%",display:"flex",flexDirection:"row-reverse",style:{zIndex:"1"},children:[this.state.currentTime,"/",this.state.playerDuration]}),Object(ke.jsxs)(z.a,{onClick:function(){e.toggleExpand()},display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"center",children:[Object(ke.jsx)(Ie,{array:this.state.metaData}),Object(ke.jsx)(k.a,{onClick:function(){e.toggleExpand()},size:"small",children:Object(ke.jsx)(Z.a,{style:{width:"24px",height:"24px"}})})]}),Object(ke.jsx)(Y.a,{onClick:function(){e.state.expand||e.toggleExpand()},in:!!this.state.expand,collapsedHeight:15,children:Object(ke.jsx)(z.a,{display:"flex",marginLeft:this.state.isChild?"40%":"20%",flexDirection:"column",flexWrap:"wrap",children:Object(ke.jsx)(Se,{commentArray:this.state.commentArr,player:this,router:this.props.router})})}),Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",justifyContent:"flex-end",marginTop:"4px",children:Object(ke.jsx)("form",{onSubmit:this.handleCommentSubmit,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",alignItems:"flex-end",children:[Object(ke.jsx)(W.a,{label:"New Comment",placeholder:". . .",require:!0,value:this.state.commentContent,onChange:this.handleTextChange,size:"small"}),Object(ke.jsx)(z.a,{mx:2,children:Object(ke.jsx)(O.a,{size:"small",type:"submit",variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),children:"Submit"})}),Object(ke.jsx)(z.a,{children:Object(ke.jsx)(O.a,{size:"small",onClick:function(){return e.clearPreviewRegions()},style:{display:this.state.containsPreviews?"flex":"none"},className:this.props.router.getStyles("b_MainWindow"),children:"Clear Regions"})})]})})})]})}}]),a}(u.a.Component),Me=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).setPrevPlayer=function(e){n.setState({prevPlayer:e})},n.state={prevPlayer:"",userDisplayName:"",userDescription:"",userGenres:"",userRole:"",userLocation:"",userAudio:"",userTracks:[],avatarURL:"",userPrivacySettings:!1},n.setPrevPlayer=n.setPrevPlayer.bind(Object(j.a)(n)),n}return Object(n.a)(a,[{key:"getPrevPlayer",value:function(){return this.state.prevPlayer}},{key:"getTracks",value:function(){this.setState({userTracks:[]});var e=[],t=this.state.userAudio;for(var a in t){var r=t[a],n=0,s=Object.values(t[a]).length;for(var i in r){var c=r[i].userID+"/audio/"+r[i].folderID+"/"+r[i].trackID;e=e.concat(Object(ke.jsx)(Pe,{isChild:n!==s-1,controller:this,router:this.props.router,audiofile:c,trackname:r[i].trackname,metadata:r[i].metadata,description:r[i].description,folderID:r[i].folderID,trackID:r[i].trackID,userID:r[i].userID})),n++}}this.setState({userTracks:e.reverse()})}},{key:"componentDidMount",value:function(){var e=this,t=v.database().ref("users/"+this.props.user),a="";t.on("value",(function(t){a=t.val(),e.setState({userDisplayName:a.displayname,userDescription:a.description,userGenres:a.genres,userRole:JSON.parse(a.roles),userLocation:a.location,userAudio:a.audio,userPrivacySettings:JSON.parse(a.privacysettings)},(function(){return e.getTracks()}))}));var r=v.storage().ref("images/"+this.props.user);r&&r.getDownloadURL().then((function(t){e.setState({avatarURL:t})})).catch((function(e){console.log("Avatar image fetch failed: "+e)}))}},{key:"render",value:function(){var e=this;return Object(ke.jsxs)("div",{className:"account-view",children:[Object(ke.jsx)(z.a,{className:"user-info",style:{backgroundColor:""},children:Object(ke.jsxs)("div",{children:[Object(ke.jsx)(F.a,{in:!0,direction:"right",children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",alignItems:"center",children:[Object(ke.jsx)(V.a,{style:{marginRight:"10px",width:"96px",height:"96px"},src:this.state.avatarURL}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",style:{height:"96px"},children:[Object(ke.jsx)(z.a,{className:"userName",children:this.state.userDisplayName}),Object(ke.jsx)(z.a,{className:"userRole",children:this.state.userRole?Object.keys(this.state.userRole).filter((function(t){return!0===e.state.userRole[t]})).join("|"):""}),Object(ke.jsx)(z.a,{className:"userRole",children:this.state.userLocation?this.state.userLocation:""})]})]})}),Object(ke.jsx)(F.a,{in:!0,direction:"right",children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",height:"100%",children:[Object(ke.jsxs)(z.a,{display:"flex",marginTop:"12px",flexDirection:"row",style:{display:this.props.user===this.props.router.getUserID()?"none":"true"},children:[Object(ke.jsx)(O.a,{variant:"outlined",size:"small",className:this.props.router.getStyles("b_MainWindow"),onClick:function(){return e.props.router.updateContent(Object(ke.jsx)(Te,{router:e.props.router,user:e.props.user}))},children:"Send Message"}),Object(ke.jsx)(O.a,{variant:"outlined",size:"small",className:this.props.router.getStyles("b_MainWindow"),children:"Add To Contacts"})]}),Object(ke.jsx)(G.a,{children:Object(ke.jsxs)(J.a,{children:[Object(ke.jsxs)(q.a,{children:[Object(ke.jsx)(H.a,{align:"left",children:Object(ke.jsx)("b",{children:"Genres"})}),Object(ke.jsx)(H.a,{children:this.state.userGenres})]}),Object(ke.jsxs)(q.a,{children:[Object(ke.jsx)(H.a,{align:"left",children:Object(ke.jsx)("b",{children:"Description"})}),Object(ke.jsx)(H.a,{children:this.state.userDescription})]})]})})]})})]})}),Object(ke.jsx)(E.a,{in:!0,timeout:1e3,children:Object(ke.jsx)(z.a,{className:"user-track",style:{backgroundColor:""},children:this.props.user===this.props.router.getUserID()||v.auth().currentUser&&v.auth().currentUser.email&&!this.state.userPrivacySettings.TracksPublic||(!v.auth().currentUser||!v.auth().currentUser.email)&&this.state.userPrivacySettings.TracksPublic?this.state.userTracks:"Please sign in to view this user's tracks"})})]})}}]),a}(u.a.Component),Ue=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={comment:n.props.comment,userDisplayName:"",playerObject:n.props.player},n}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=v.database().ref("users/"+this.props.userID),a="";t.on("value",(function(t){a=t.val(),e.setState({userDisplayName:a.displayname?a.displayname:"Anonymous"})}))}},{key:"parsedComment",value:function(){var e=this,t=this.state.comment.split(new RegExp("(\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d\\s|\\d\\:\\d\\d\\-\\d\\:\\d\\d\\s)")),a=new RegExp("^\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d\\s|^\\d\\:\\d\\d\\-\\d\\:\\d\\d\\s| \\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d|\\d\\:\\d\\d\\-\\d\\:\\d\\d |\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d$|\\d\\:\\d\\d\\-\\d\\:\\d\\d$|^\\d\\d\\:\\d\\d\\-\\d\\d\\:\\d\\d$|^\\d\\:\\d\\d\\-\\d\\:\\d\\d$","g");return t.map((function(t){if(t)return t.match(a)?Object(ke.jsx)("div",{children:Object(ke.jsx)(B.a,{size:"small",label:t,clickable:!0,variant:"outlined",onClick:function(){e.state.playerObject.playFrom(t)},style:{backgroundColor:"hsla(200, 50%, 70%, 0.4)",borderColor:"hsla(200, 50%, 70%, 0.4)"}})}):Object(ke.jsx)("div",{children:t})}))}},{key:"render",value:function(){var e=this;return Object(ke.jsxs)(R.a,{display:"flex",flexDirection:"column",alignItems:"flex-start",flexWrap:"wrap",minWidth:"96px",elevation:0,style:{backgroundColor:"lightgrey",margin:"4px",padding:"6px"},borderRadius:4,children:[Object(ke.jsx)(z.a,{className:"user",display:"flex",flexDirection:"row",alignItems:"center",children:Object(ke.jsxs)(k.a,{size:"small",onClick:function(){return e.props.router.updateContent(Object(ke.jsx)(Me,{router:e.props.router,user:e.props.userID}))},children:[Object(ke.jsx)(_.a,{}),this.state.userDisplayName]})}),Object(ke.jsx)("div",{className:"comment",children:this.parsedComment()})]})}}]),a}(u.a.Component),Ne=(a(110),function(e){var t="";if(e.convos){t=e.convos.map((function(e){var t="";return v.database().ref("users/"+e+"/displayname").on("value",(function(e){t=e.val()})),[e,t]})).map((function(t){return Object(ke.jsxs)("div",{children:[Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",alignItems:"center",children:Object(ke.jsxs)(O.a,{onClick:function(){return e.setActive(t[0])},style:{justifyContent:"left",minWidth:"100%"},children:[Object(ke.jsx)(_.a,{}),t[1]]})}),Object(ke.jsx)(y.a,{})]})}))}return Object(ke.jsx)("div",{children:t})});function Re(e){var t="";e.messageArray.length>0&&(t=e.messageArray.map((function(t){if(""!==t)return Object(ke.jsx)(E.a,{in:!0,timeout:500,children:Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",justifyContent:t.author===e.router.getUserID()?"flex-end":"flex-start",children:Object(ke.jsx)(Ue,{userID:t.author,comment:t.body,player:e.player})})})})));return Object(ke.jsx)("div",{children:t})}var Te=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).setConvo=function(e){var t="";n.setState({currentMessages:[]},(function(){if(e!==n.props.router.getUserID()){if(0!==n.state.userConvos.length){var a=0,r=Object.keys(n.state.userConvos);for(var s in r){if(e===r[s])break;a++}if(t=Object.entries(n.state.userConvos)[a]){var i=t[1];n.setState({currentConvo:t[0],currentMessages:Object.values(i.messages)})}}if(0===n.state.userConvos.length||!t)n.setState({currentConvo:e,currentMessages:[""]}),v.database().ref("users/"+n.props.router.getUserID()+"/conversations/"+e).update({messages:[""]})}}))},n.handleMessageSend=function(e){if(e.preventDefault(),n.state.messageContent&&n.state.currentConvo&&n.state.currentConvo!==n.props.router.getUserID()){var t=v.database().ref("users/"+n.state.currentConvo+"/conversations/"+n.props.router.getUserID()),a=v.database().ref("users/"+n.props.router.getUserID()+"/conversations/"+n.state.currentConvo),r={author:n.props.router.getUserID(),body:n.state.messageContent},s=[];""!==n.state.currentMessages[0]?s=n.state.currentMessages.concat(r):s[0]=r,n.setState({currentMessages:s,messageContent:""},(function(){t.update({messages:n.state.currentMessages}),a.update({messages:n.state.currentMessages})}))}},n.handleTextChange=function(e){n.setState({messageContent:e.target.value}),e.preventDefault()},n.state={userDisplayName:"",userConvos:"",convoNames:"",currentMessages:[],currentConvo:"",messageContent:"",activeConvos:""},n.setConvo=n.setConvo.bind(Object(j.a)(n)),n}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=v.database().ref("users/"+this.props.router.getUserID()),a="";t.on("value",(function(t){(a=t.exportVal()).conversations?e.setState({userConvos:a.conversations},(function(){e.setConvo(Object.keys(e.state.userConvos)[0])})):e.setState({userConvos:[]},(function(){return e.setConvo(e.props.user)}))}),(function(){t.off()}))}},{key:"render",value:function(){return Object(ke.jsxs)("div",{className:"conversations",children:[Object(ke.jsx)(z.a,{className:"convo-section",children:Object(ke.jsx)("div",{children:Object(ke.jsx)(F.a,{in:!0,direction:"right",children:Object(ke.jsxs)(z.a,{children:["Active Conversations",Object(ke.jsx)(Ne,{router:this.props.router,setActive:this.setConvo,convos:Object.keys(this.state.userConvos)})]})})})}),Object(ke.jsxs)("div",{className:"user-convo",children:[Object(ke.jsx)(z.a,{mr:"4%",style:{overflowY:"auto"},children:Object(ke.jsx)(Re,{messageArray:this.state.currentMessages,player:null,router:this.props.router})}),Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",justifyContent:"flex-end",mt:"2%",mr:"4%",children:Object(ke.jsx)("form",{onSubmit:this.handleMessageSend,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",alignItems:"flex-end",children:[Object(ke.jsx)(W.a,{label:"New Message",placeholder:". . .",require:!0,value:this.state.messageContent,onChange:this.handleTextChange,size:"small",fullWidth:!0}),Object(ke.jsx)(z.a,{children:Object(ke.jsx)(O.a,{size:"small",type:"submit",variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),children:"Send"})})]})})})]})]})}}]),a}(u.a.Component);function Ae(e){var t=u.a.useState(!1),a=Object(P.a)(t,2),r=a[0],n=a[1],s=u.a.useRef(null),i=function(e){s.current&&s.current.contains(e.target)||n(!1)},c=function(t){e.header.accountView(),i(t),t.preventDefault()},o=function(t){e.header.accountSettings(),i(t),t.preventDefault()},l=function(t){e.router.updateContent(Object(ke.jsx)(Te,{router:e.router,user:e.router.getUserID()})),i(t),t.preventDefault()},d=function(t){e.router.signOut(),n(!1),t.preventDefault()},h=u.a.useRef(r);return u.a.useEffect((function(){!0===h.current&&!1===r&&s.current.focus(),h.current=r}),[r]),Object(ke.jsxs)("div",{children:[Object(ke.jsx)(k.a,{className:e.router.getStyles("b_MenuIcon"),onClick:function(){n((function(e){return!e}))},children:Object(ke.jsx)(L.a,{})}),Object(ke.jsx)("div",{ref:s}),Object(ke.jsx)(T.a,{open:r,anchorEl:s.current,transition:!0,children:function(t){var a=t.TransitionProps;return Object(ke.jsx)(m.a,Object(I.a)(Object(I.a)({},a),{},{in:r,style:{transformOrigin:"right"},children:Object(ke.jsx)(R.a,{square:!0,elevation:0,className:e.router.getStyles("headerMenu"),children:Object(ke.jsx)(M.a,{onClickAway:i,children:Object(ke.jsxs)(N.a,{autoFocusItem:r,children:[Object(ke.jsxs)("div",{hidden:""===e.router.getUserID(),children:[Object(ke.jsx)(U.a,{onClick:c,children:"Profile"}),Object(ke.jsx)(y.a,{light:!0,variant:"middle",className:e.router.getStyles("divider")}),Object(ke.jsx)(U.a,{onClick:l,children:"View Messages"}),Object(ke.jsx)(y.a,{light:!0,variant:"middle",className:e.router.getStyles("divider")}),Object(ke.jsx)(U.a,{onClick:o,children:"My account"}),Object(ke.jsx)(y.a,{variant:"middle",className:e.router.getStyles("divider")}),Object(ke.jsx)(U.a,{onClick:d,children:"Logout"})]}),Object(ke.jsxs)("div",{children:[Object(ke.jsx)(U.a,{onClick:i,children:"---"}),Object(ke.jsx)(y.a,{variant:"middle",className:e.router.getStyles("divider")}),Object(ke.jsx)(U.a,{onClick:i,children:"About"})]})]})})})}))}})]})}var Le=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).submitChanges=function(e){n.props.router.setLoadingState(!0),v.database().ref("users/"+n.props.router.getUserID()).update({displayname:n.state.userDisplayName,description:n.state.userDescription,roles:JSON.stringify(n.state.userRoles),location:n.state.userLocation,privacysettings:JSON.stringify(n.state.userPrivacySettings)},(function(){return n.props.router.setLoadingState(!1)})),n.state.avatarURL&&(n.props.router.setLoadingState(!0),v.storage().ref().child("images/"+n.props.router.getUserID()).put(n.state.avatarImage).then((function(e){console.log("Avatar image upload success")})).then((function(){return n.props.router.setLoadingState(!1)})).catch((function(e){console.log("Avatar image upload fail"+e)}))),n.props.router.updateContent(Object(ke.jsx)(Me,{router:n.props.router,user:n.props.router.getUserID()}))},n.handleFileSelect=function(e){n.fileInput.current.files[0]!==n.state.avatarImage&&n.setState({avatarImage:n.fileInput.current.files[0],avatarURL:URL.createObjectURL(n.fileInput.current.files[0]),changesMade:!0}),e.preventDefault()},n.handleChange=function(e){if(n.setState({changesMade:!0}),e.target.name.match("Producer|Engineer|Composer|Artist")){if(n.state.userRoles){var t=n.state.userRoles;e.target.checked?t[e.target.name]=!0:t[e.target.name]=!1,n.setState({userRoles:t})}}else if(e.target.name.match("BrowseUsers|TracksPublic")){if(n.state.userPrivacySettings){var a=n.state.userPrivacySettings;e.target.checked?a[e.target.name]=!0:a[e.target.name]=!1,n.setState({userPrivacySettings:a})}}else n.setState(Object(be.a)({},e.target.name,e.target.value))},n.state={userEmail:"",userDisplayName:"",userDescription:"",userGenres:"",userRoles:[],userLocation:"",userPrivacySettings:[],selection:0,changesMade:!1,avatarImage:"",avatarURL:""},n.fileInput=u.a.createRef(),n}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=v.database().ref("users/"+this.props.router.getUserID()),a="";t.on("value",(function(t){(a=t.exportVal())&&e.setState({userEmail:a.email,userDisplayName:a.displayname,userDescription:a.description?a.description:"",userGenres:a.genres?a.genres:"",userRoles:JSON.parse(a.roles),userLocation:a.location?a.location:"",userPrivacySettings:JSON.parse(a.privacysettings)},(function(){}))}));var r=v.storage().ref("images/"+this.props.router.getUserID());r&&r.getDownloadURL().then((function(t){e.setState({avatarImage:t})})).catch((function(e){console.log("Avatar image fetch failed: "+e)}))}},{key:"render",value:function(){var e=this;return Object(ke.jsxs)("div",{className:"conversations",children:[Object(ke.jsx)(z.a,{className:"convo-section",children:Object(ke.jsx)("div",{children:Object(ke.jsx)(F.a,{in:!0,direction:"right",children:Object(ke.jsxs)("div",{children:["My Account",Object(ke.jsx)(O.a,{onClick:function(){return e.setState({selection:0})},style:{justifyContent:"left",minWidth:"100%"},children:"Account Information"}),Object(ke.jsx)(y.a,{}),Object(ke.jsx)(O.a,{onClick:function(){return e.setState({selection:1})},style:{justifyContent:"left",minWidth:"100%"},children:"Privacy Settings"}),Object(ke.jsx)(y.a,{}),Object(ke.jsx)(O.a,{onClick:function(){return e.setState({selection:2})},style:{justifyContent:"left",minWidth:"100%"},children:"Display Preferences"})]})})})}),Object(ke.jsxs)("div",{className:"user-convo",children:[Object(ke.jsxs)("div",{style:{flexDirection:"column"},hidden:0!==this.state.selection,children:["Account Information",Object(ke.jsx)("div",{children:"Custom Avatar"}),Object(ke.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[Object(ke.jsx)(V.a,{style:{marginRight:"10px",width:"128px",height:"128px"},src:this.state.avatarURL?this.state.avatarURL:this.state.avatarImage}),Object(ke.jsx)($.a,{title:"Upload a custom avatar",arrow:!0,placement:"right",children:Object(ke.jsx)(ve.a,{style:{alignSelf:"center"},type:"file",inputProps:{ref:this.fileInput,accept:"image/png, image/gif, image/jpeg"},required:!0,onChange:this.handleFileSelect,startAdornment:Object(ke.jsx)(Oe.a,{children:Object(ke.jsx)(C.a,{})})})})]}),Object(ke.jsx)(W.a,{label:"Display Name",placeholder:". . .",name:"userDisplayName",value:this.state.userDisplayName,onChange:this.handleChange,size:"small",fullWidth:!0}),Object(ke.jsx)(W.a,{label:"Description",placeholder:". . .",name:"userDescription",value:this.state.userDescription,onChange:this.handleChange,size:"small",fullWidth:!0}),Object(ke.jsx)(W.a,{label:"Location",placeholder:". . .",name:"userLocation",value:this.state.userLocation,onChange:this.handleChange,size:"small",fullWidth:!0}),"My Roles",Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",children:function(){if(e.state.userRoles){return["Producer","Engineer","Composer","Artist"].map((function(t){return Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{name:t,checked:e.state.userRoles[t],onChange:e.handleChange},Math.random()),label:t})}))}}})]}),Object(ke.jsxs)("div",{hidden:1!==this.state.selection,children:["Privacy Settings",Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",children:function(){if(e.state.userPrivacySettings){var t=["Show your profile on the public browse users page?","Allow unregistered users to view your tracks?"];return["BrowseUsers","TracksPublic"].map((function(a,r){return Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{name:a,checked:e.state.userPrivacySettings[a],onChange:e.handleChange},Math.random()),label:t[r]})}))}}})]}),Object(ke.jsxs)("div",{hidden:2!==this.state.selection,children:["Display Preferences",Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{}),label:"Display 1"})]}),Object(ke.jsx)(O.a,{disabled:!this.state.changesMade,onClick:this.submitChanges,children:"Submit"})]})]})}}]),a}(u.a.Component),ze=a(217),Ee=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={avatarURL:""},n}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=g.a.storage().ref().child("images/"+this.props.user);t&&t.getDownloadURL().then((function(t){e.setState({avatarURL:t})})).catch((function(e){console.log("Avatar image fetch error: "+e)}))}},{key:"render",value:function(){var e=this;return Object(ke.jsx)(z.a,{display:"flex",flexDirection:"row",alignItems:"center",m:4,onClick:function(){return e.props.router.updateContent(Object(ke.jsx)(Me,{router:e.props.router,user:e.props.user}))},children:Object(ke.jsx)(f.a,{elevation:"6",children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",alignItems:"center",p:2,children:[Object(ke.jsx)(V.a,{style:{width:"96px",height:"96px"},src:this.state.avatarURL}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",m:2,children:[Object(ke.jsx)("div",{style:{fontSize:"18px"},children:this.props.displayName}),Object(ke.jsx)("div",{style:{fontSize:"14px"},children:this.props.roles}),Object(ke.jsx)("div",{style:{fontSize:"14px"},children:this.props.location})]})]})})})}}]),a}(u.a.Component),Fe=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={userList:[]},n}return Object(n.a)(a,[{key:"componentWillUnmount",value:function(){g.a.database().ref("users/").off("value")}},{key:"componentDidMount",value:function(){var e=this;g.a.database().ref("users/").on("value",(function(t){var a=t.exportVal();e.getUsers(a)}))}},{key:"getUsers",value:function(e){var t=this,a=Object.entries(e),r=[];a.map((function(e){var a=JSON.parse(e[1].roles),n=JSON.parse(e[1].privacysettings),s=Object(ke.jsx)(Ee,{router:t.props.router,user:e[0],displayName:e[1].displayname,roles:e[1].roles?Object.keys(a).filter((function(e){return!0===a[e]})).join("|"):"",location:e[1].location?e[1].location:""});n.BrowseUsers&&r.push(s)})),this.setState({userList:r})}},{key:"render",value:function(){return Object(ke.jsx)(m.a,{in:!0,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",height:"100%",children:[Object(ke.jsx)(ge.a,{title:"Recent Users"}),Object(ke.jsx)(ze.a,{container:!0,justify:"center",children:this.state.userList}),Object(ke.jsx)(z.a,{})]})})}}]),a}(u.a.Component),We=a(219),_e=a(10),Be=a(125),Ve=a(128),Ge=a(126),Je=a.p+"static/media/speaker.1ca362d1.glb",qe=new _e.cb,He=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).container=u.a.createRef(),n}return Object(n.a)(a,[{key:"componentDidMount",value:function(){var e=new _e.T(60,window.innerWidth/window.innerHeight,.1,1500),t=new _e.rb({alpha:!0,antialias:!0});t.setSize(.6*window.innerWidth,.7*window.innerHeight),this.container.appendChild(t.domElement),window.addEventListener("resize",(function(){e.aspect=window.innerWidth/window.innerHeight,e.focus=10,e.updateProjectionMatrix(),t.setSize(window.innerWidth,window.innerHeight)}),!1);var a=new _e.J({color:16761600});(new Be.a).load(Je,(function(r){r.scene.children.forEach((function(e){e.material=a,e.material.needsUpdate=!0})),qe.add(r.scene);var n=r.animations,s=new _e.b(r.scene),i=new _e.i;n.forEach((function(e){s.clipAction(e).play()})),r.scene.scale.set(.2,.2,.2);var c=new Ve.a(t);c.addPass(new Ge.a(qe,e));!function e(){s&&s.update(2*i.getDelta()),requestAnimationFrame(e),r.scene.rotation.y+=.01,c.render()}()}),void 0,(function(e){console.error(e)})),e.position.z=4,e.setViewOffset(window.innerWidth,window.innerHeight,0*window.innerWidth,.2*window.innerHeight,window.innerWidth,window.innerHeight)}},{key:"componentWillUnmount",value:function(){qe.clear()}},{key:"render",value:function(){var e=this;return Object(ke.jsx)("div",{ref:function(t){return e.container=t}})}}]),a}(u.a.Component),$e=a(234),Ye=a(218),Ke=a(229),Xe=a(90),Qe=a.n(Xe),Ze=a(91),et=a.n(Ze),tt=["Credentials","Personalization","Privacy Settings"],at=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleChange=function(e){if(e.target.name.match("Producer|Engineer|Composer|Artist")){var t=n.state.userRoles;e.target.checked?t[e.target.name]=!0:t[e.target.name]=!1,n.setState({userRoles:t})}else if(e.target.name.match("BrowseUsers|TracksPublic")){var a=n.state.userPrivacySettings;e.target.checked?a[e.target.name]=!0:a[e.target.name]=!1,n.setState({userPrivacySettings:a})}else n.setState(Object(I.a)(Object(I.a)({},n.state),{},Object(be.a)({},e.target.name,e.target.value)))},n.handleAccountCreation=function(e){var t={email:n.state.userEmail,displayname:n.state.userDisplayName,description:n.state.userDescription,genres:n.state.userGenres,roles:JSON.stringify(n.state.userRoles),location:n.state.userLocation,privacysettings:JSON.stringify(n.state.userPrivacySettings)};if(v.auth().currentUser){var a=v.auth.EmailAuthProvider.credential(n.state.userEmail,n.state.userPassword);v.auth().currentUser.linkWithCredential(a).then((function(e){var a=e.user;v.database().ref("users/"+a.uid).update(t),n.props.router.setUser(a)})).catch((function(e){console.log("Error upgrading anonymous account",e)}))}else v.auth().createUserWithEmailAndPassword(n.state.userEmail,n.state.userPassword).then((function(e){var a=e.user;v.database().ref("users/"+a.uid).set(t),n.props.router.setUser(a)})).catch((function(e){alert("Account creation error: "+e)}));e.preventDefault()},n.returnButton=function(){n.props.router.previousHandler()},n.backButton=function(){var e=n.state.activeStep;e>0&&n.setState({activeStep:e-1,inProp:!0},(function(){return n.setState({inProp:!1})}))},n.nextButton=function(){var e=n.state.activeStep;e<tt.length-1&&n.setState({activeStep:e+1,inProp:!0},(function(){return n.setState({inProp:!1})}))},n.state={activeStep:0,inProp:!0,slideStep:0,userEmail:"",userPassword:"",userDescription:"",userDisplayName:"",userGenres:[],userLocation:"",userRoles:{Producer:!1,Engineer:!1,Composer:!1,Artist:!1},userPrivacySettings:{BrowseUsers:!0,TracksPublic:!0}},n.handleChange=n.handleChange.bind(Object(j.a)(n)),n.handleAccountCreation=n.handleAccountCreation.bind(Object(j.a)(n)),n}return Object(n.a)(a,[{key:"render",value:function(){var e=this;return Object(ke.jsx)(m.a,{in:!0,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[Object(ke.jsx)(ge.a,{title:"Create New Account"}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",mx:10,children:[Object(ke.jsx)(z.a,{children:Object(ke.jsx)("div",{style:{visibility:0===this.state.activeStep?"hidden":"visible"},children:Object(ke.jsx)(k.a,{onClick:function(){return e.backButton()},children:Object(ke.jsx)(Qe.a,{fontSize:"large"})})})}),Object(ke.jsx)(z.a,{display:"flex",width:"50%",flexDirection:"column",justifyContent:"center",alignSelf:"center",children:Object(ke.jsx)(F.a,{in:this.state.inProp,onExited:function(){return e.setState({inProp:!e.state.inProp,slideStep:e.state.activeStep})},direction:"up",children:Object(ke.jsxs)("div",{children:[Object(ke.jsx)("div",{hidden:0!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",children:[Object(ke.jsx)(W.a,{label:"New Email",name:"userEmail",placeholder:". . .",size:"medium",type:"email",onChange:this.handleChange}),Object(ke.jsx)(W.a,{label:"New Password",name:"userPassword",placeholder:". . .",size:"medium",type:"password",onChange:this.handleChange})]})}),Object(ke.jsx)("div",{hidden:1!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",children:[Object(ke.jsx)(W.a,{label:"Display Name",name:"userDisplayName",placeholder:". . .",size:"medium",onChange:this.handleChange}),Object(ke.jsx)(W.a,{label:"Description",name:"userDescription",placeholder:". . .",size:"medium",onChange:this.handleChange}),Object(ke.jsx)(W.a,{label:"Genres",name:"userGenres",placeholder:". . .",size:"medium",onChange:this.handleChange}),Object(ke.jsx)(W.a,{label:"Location",name:"userLocation",placeholder:". . .",size:"medium",onChange:this.handleChange}),Object(ke.jsx)("h2",{style:{textAlign:"center"},children:"User Roles:"}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",alignSelf:"center",children:[Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"0",name:"Producer",onChange:this.handleChange}),label:"Producer"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"1",name:"Engineer",onChange:this.handleChange}),label:"Engineer"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"2",name:"Composer",onChange:this.handleChange}),label:"Composer"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"3",name:"Artist",onChange:this.handleChange}),label:"Artist"})]})]})}),Object(ke.jsx)("div",{hidden:2!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"4",name:"BrowseUsers",defaultChecked:!0,onChange:this.handleChange}),label:"Show your profile on the public browse users page?"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"5",name:"TracksPublic",defaultChecked:!0,onChange:this.handleChange}),label:"Allow unregistered users to view your tracks?"}),Object(ke.jsx)("form",{onSubmit:this.handleAccountCreation,children:Object(ke.jsx)(z.a,{m:2,children:Object(ke.jsx)(O.a,{variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),type:"submit",children:"Finish"})})})]})})]})})}),Object(ke.jsx)(z.a,{children:Object(ke.jsx)("div",{style:{visibility:2===this.state.activeStep?"hidden":"visible"},children:Object(ke.jsx)(k.a,{onClick:function(){return e.nextButton()},children:Object(ke.jsx)(et.a,{fontSize:"large"})})})})]}),Object(ke.jsx)($e.a,{activeStep:this.state.activeStep,alternativeLabel:!0,children:tt.map((function(e){return Object(ke.jsx)(Ye.a,{children:Object(ke.jsx)(Ke.a,{orientation:"vertical",children:e})},e)}))})]})})}}]),a}(u.a.Component),rt=["Upload Your Track","Describe This Track","Identify Problem Areas","Now Matching . . .","Review","Your Feedback"],nt={activeStep:0,inProp:!0,slideStep:0,matching:!1,sectionValid:!1,matchingStatus:"",trackPreviewPlayer:"",trackName:"",trackDescription:"",trackMetaData:["","","",""],userID:"",audioFile:"",metaDataOther:"",other:!1,trackIsPublic:!1,trackMatchPlayer:"",mFolderID:"",mTrackID:"",mTrackName:"",mMetaData:["","","",""],mTrackDescription:"",currentUserID:"",currentFolderID:"",currentTrackID:"",reviewedTrackPlayer:"",matchedUserID:"",keepTracks:!1,anonymousID:""},st=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).cleanup=function(){return new Promise((function(e,t){n.state.currentUserID&&(v.database().ref("matching/"+n.state.currentUserID).remove().catch((function(e){console.log("Matching DB cleanup error: "+e)})),n.props.router.getUserID()||n.state.keepTracks||v.database().ref("users/"+n.state.currentUserID).remove().catch((function(e){console.log("User DB cleanup fail: "+e.message)})),n.state.trackIsPublic||n.state.keepTracks||(v.database().ref("users/"+n.state.currentUserID+"/audio/"+n.state.currentFolderID+"/"+n.state.currentTrackID).remove().catch((function(e){console.log("User DB cleanup fail: "+e.message)})),v.storage().ref().child("audio/"+n.state.currentFolderID+"/"+n.state.currentTrackID).delete().catch((function(e){console.log("Storage cleanup error: "+e)}))))}))},n.matchAgain=function(){n.cleanup().then(n.props.router.updateContent(Object(ke.jsx)(a,{router:n.props.router,user:n.props.router.getUserID()}))).catch((function(e){console.log("Cleanup error: "+e)}))},n.backButton=function(e){var t=n.state.activeStep;t>0&&n.setState({activeStep:t-1,inProp:!0},(function(){n.checkSection(),n.setState({inProp:!1})})),e&&e.preventDefault()},n.nextButton=function(e){var t=n.state.activeStep;t<rt.length-1&&n.setState({activeStep:t+1,inProp:!0},(function(){return n.setState({inProp:!1,sectionValid:!1})})),e&&e.preventDefault()},n.handleChange=function(e){if(e.target.name.match("Mixing|Mastering|Arrangement")){var t=Object(me.a)(n.state.trackMetaData),a=parseInt(e.target.id);e.target.checked?t[a]=e.target.name:t[a]="",n.setState({trackMetaData:t})}else n.setState(Object(I.a)(Object(I.a)({},n.state),{},Object(be.a)({},e.target.name,e.target.value)),(function(){if(e.target.name.match("metaDataOther")){var t=Object(me.a)(n.state.trackMetaData);t[3]=n.state.metaDataOther,n.setState({trackMetaData:t})}n.checkSection()}))},n.handleFileSelect=function(e){n.fileInput.current.files[0]!==n.state.audioFile&&n.setState({audioFile:n.fileInput.current.files[0]},(function(){return n.drawPreview(n.fileInput.current.files[0])})),e.preventDefault()},n.drawPreview=function(e){var t=Object(ke.jsx)(Pe,{isChild:!1,preview:!0,router:n.props.router,audiofile:e,trackname:n.state.trackName,metadata:[],description:""});n.setState({trackPreviewPlayer:""},(function(){return n.setState({trackPreviewPlayer:t,sectionValid:!0})}))},n.drawMatchTrack=function(){var e=v.database().ref("matching/"+n.state.currentUserID+"/matchObject"),t=e.on("value",(function(a){var r=a.val(),s=v.database().ref("users/"+r.matchID+"/audio/"+r.folder+"/"+r.track),i=s.on("value",(function(a){if(a.exists()){var c=a.val(),o=Object(ke.jsx)(Pe,{isChild:!1,router:n.props.router,audiofile:r.matchID+"/audio/"+r.folder+"/"+r.track,trackname:c.trackname,metadata:c.metadata,description:c.description,folderID:r.folder,trackID:r.track,userID:r.matchID});n.setState({trackMatchPlayer:o,mFolderID:c.folderID,mTrackID:c.trackID,mTrackName:c.trackname,mMetaData:c.metadata,mTrackDescription:c.description}),e.off("value",t),s.off("value",i),v.database().ref("matching/"+n.state.currentUserID).remove().catch((function(e){console.log("Matching DB cleanup fail: "+e.message)}))}}))}))},n.handleMatch=function(e){n.nextButton();var t="";function a(){var e=this;v.auth().signInAnonymously().then((function(){v.auth().onAuthStateChanged((function(a){t=a.uid,e.setState({anonymousID:a.uid}),r()}))}))}function r(){var e,a=this,r=v.database().ref().push();e=r.key;var n=v.database().ref().push().key;t?this.setState({matchingStatus:"Uploading your track . . .",currentUserID:t,currentFolderID:e,currentTrackID:n},(function(){var t=v.storage().ref().child(a.state.currentUserID+"/audio/"+e+"/"+n),r=a.state.audioFile;t.put(r).then((function(r){a.state.currentUserID?(console.log("File upload success"),a.setState({matchingStatus:"Searching for match . . ."}),v.database().ref("users/"+a.state.currentUserID+"/audio/"+e+"/"+n).set({folderID:e,trackID:n,userID:a.state.currentUserID,trackname:a.state.trackName,description:a.state.trackDescription,metadata:a.state.trackMetaData,commentdata:[""]}).then((function(){v.database().ref("matching/"+a.state.currentUserID).set({test:!0}).catch((function(e){console.log("Matching queue fail - "+e)}));var t={matchID:a.state.currentUserID,folder:e,track:n},r=v.database().ref("matching/").limitToLast(1),s=r.on("child_added",(function(e){e.key!==a.state.currentUserID&&v.database().ref("matching/"+e.key).update({matchObject:t})})),i=v.database().ref("matching/"+a.state.currentUserID),c=i.on("child_added",(function(e){if("matchObject"===e.key){var n=v.database().ref("matching/"+e.child("matchID").val());e.child("matchID").val()!==a.state.currentUserID&&(n.update({matchObject:t}),a.setState({matchedUserID:e.child("matchID").val()}),console.log("Matched user ID: "+a.state.matchedUserID),r.off("child_added",s),i.off("child_added",c),a.nextButton(),a.drawMatchTrack())}}))})).catch((function(e){alert("Matching fail"+e)}))):(console.log("Match session creation fail - session canelled during upload"),t.delete())})).catch((function(e){alert("File Upload fail"+e)}))})):(alert("Cannot match - user auth failure"),this.matchAgain())}r=r.bind(Object(j.a)(n)),a=a.bind(Object(j.a)(n)),n.props.router.getUserID()?(t=n.props.router.getUserID(),r()):a(),e.preventDefault()},n.finishReview=function(e){var t=Object(ke.jsx)(Pe,{isChild:!1,controller:Object(j.a)(n),router:n.props.router,audiofile:n.state.currentUserID+"/audio/"+n.state.currentFolderID+"/"+n.state.currentTrackID,trackname:n.state.trackName,metadata:n.state.trackMetaData,description:n.state.trackDescription,folderID:n.state.currentFolderID,trackID:n.state.currentTrackID,userID:n.state.currentUserID});n.setState({reviewedTrackPlayer:t},n.nextButton()),e.preventDefault()},n.state=nt,n.handleFileSelect=n.handleFileSelect.bind(Object(j.a)(n)),n.handleMatch=n.handleMatch.bind(Object(j.a)(n)),n.finishReview=n.finishReview.bind(Object(j.a)(n)),n.drawMatchTrack=n.drawMatchTrack.bind(Object(j.a)(n)),n.cleanup=n.cleanup.bind(Object(j.a)(n)),n.matchAgain=n.matchAgain.bind(Object(j.a)(n)),n.fileInput=u.a.createRef(),n.previewRef=u.a.createRef(),n}return Object(n.a)(a,[{key:"componentWillUnmount",value:function(){this.cleanup(),this.state=nt,v.database().ref("matching/").off("child_added")}},{key:"checkSection",value:function(){(1===this.state.activeStep&&this.state.trackName||0===this.state.activeStep&&this.state.trackPreviewPlayer)&&this.setState({sectionValid:!0})}},{key:"render",value:function(){var e=this;return Object(ke.jsx)(m.a,{in:!0,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[Object(ke.jsx)(ge.a,{title:"Instant Matching"}),Object(ke.jsx)(z.a,{height:"30%",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",children:Object(ke.jsx)("div",{hidden:this.state.slideStep>=3,children:Object(ke.jsx)(Y.a,{in:this.state.trackPreviewPlayer,children:Object(ke.jsx)(z.a,{children:this.state.trackPreviewPlayer})})})}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"row",width:"70%",justifyContent:"space-between",alignSelf:"center",alignItems:"center",children:[Object(ke.jsx)(z.a,{children:Object(ke.jsx)("div",{style:{visibility:0===this.state.activeStep||this.state.activeStep>=3?"hidden":"visible"},children:Object(ke.jsx)(k.a,{onClick:function(){return e.backButton()},children:Object(ke.jsx)(Qe.a,{fontSize:"large"})})})}),Object(ke.jsx)(z.a,{display:"flex",flexDirection:"column",alignContent:"center",children:Object(ke.jsx)("h2",{children:rt[this.state.activeStep]})}),Object(ke.jsx)(z.a,{children:Object(ke.jsx)($.a,{title:"Please fill out all required fields",arrow:!0,placement:"right",disableHoverListener:this.state.sectionValid,children:Object(ke.jsx)("div",{style:{visibility:this.state.activeStep>=3?"hidden":"visible"},children:Object(ke.jsx)(k.a,{onClick:function(){return e.nextButton()},disabled:!this.state.sectionValid,children:Object(ke.jsx)(et.a,{fontSize:"large"})})})})})]}),Object(ke.jsx)(z.a,{display:"flex",height:"70%",width:"50%",flexDirection:"column",justifyContent:"center",alignSelf:"center",mx:5,children:Object(ke.jsx)(F.a,{in:this.state.inProp,onExited:function(){return e.setState({inProp:!e.state.inProp,slideStep:e.state.activeStep})},direction:"up",children:Object(ke.jsxs)("div",{children:[Object(ke.jsx)("div",{hidden:0!==this.state.slideStep,children:Object(ke.jsx)(z.a,{display:"flex",flexDirection:"column",children:Object(ke.jsx)(ve.a,{type:"file",inputProps:{ref:this.fileInput,accept:"audio/flac, audio/m4a, audio/wav, audio/mp3, audio/aac"},required:!0,onChange:this.handleFileSelect,startAdornment:Object(ke.jsx)(Oe.a,{children:Object(ke.jsx)(w.a,{})})})})}),Object(ke.jsx)("div",{hidden:1!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",children:[Object(ke.jsx)(W.a,{label:"Track Name",name:"trackName",placeholder:". . .",size:"medium",required:"true",value:this.state.trackName,onChange:this.handleChange}),Object(ke.jsx)(W.a,{label:"Description",name:"trackDescription",placeholder:". . .",size:"medium",value:this.state.trackDescription,onChange:this.handleChange})]})}),Object(ke.jsx)("div",{hidden:2!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",children:[Object(ke.jsxs)("div",{children:[Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"0",name:"Mixing",onChange:this.handleChange}),label:"Mixing"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"1",name:"Mastering",onChange:this.handleChange}),label:"Mastering"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{id:"2",name:"Arrangement",onChange:this.handleChange}),label:"Arrangement"}),Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{name:"other",onClick:function(){e.setState({other:!e.state.other})}}),label:"Other"}),Object(ke.jsxs)(Y.a,{in:!!this.state.other,display:"flex",flexDirection:"column",children:[Object(ke.jsx)("div",{children:'Please specify "Other" tag (Limit 12 characters):'}),Object(ke.jsx)(W.a,{name:"metaDataOther",placeholder:". . .",size:"medium",inputProps:{maxLength:12},value:this.state.metaDataOther,onChange:this.handleChange})]}),Object(ke.jsx)("div",{hidden:!this.props.router.getUserID(),children:Object(ke.jsx)(ye.a,{control:Object(ke.jsx)(De.a,{name:"trackIsPublic",onClick:function(){e.setState({trackIsPublic:!e.state.trackIsPublic})}}),label:"Save track to account"})})]}),Object(ke.jsx)(O.a,{onClick:this.handleMatch,variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),children:"Match"})]})}),Object(ke.jsx)("div",{hidden:3!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",alignItems:"center",children:[Object(ke.jsx)("h2",{children:this.state.matchingStatus}),Object(ke.jsx)(b.a,{})]})}),Object(ke.jsx)("div",{hidden:4!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",children:["Please offer constructive criticism.",this.state.trackMatchPlayer,Object(ke.jsx)(O.a,{onClick:this.finishReview,variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),children:"Continue"})]})}),Object(ke.jsx)("div",{hidden:5!==this.state.slideStep,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",children:["Your feedback is here:",this.state.reviewedTrackPlayer,Object(ke.jsx)(O.a,{onClick:this.matchAgain,variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),children:"Match Again"}),Object(ke.jsx)("div",{hidden:!!this.props.router.getUserID(),children:Object(ke.jsx)(O.a,{onClick:function(){e.setState({keepTracks:!0},(function(){return e.props.router.updateContent(Object(ke.jsx)(at,{router:e.props.router,anonymousID:e.state.anonymousID}))}))},variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),children:"Create An Account"})})]})})]})})}),Object(ke.jsx)($e.a,{activeStep:this.state.activeStep,alternativeLabel:!0,size:"small",children:rt.map((function(e){return Object(ke.jsx)(Ye.a,{children:Object(ke.jsx)(Ke.a,{orientation:"vertical",children:e})},e)}))})]})})}}]),a}(u.a.Component),it=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(r.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).newAccount=function(){e.props.router.updateContent(Object(ke.jsx)(at,{router:e.props.router}))},e.startMatch=function(){e.props.router.updateContent(Object(ke.jsx)(st,{router:e.props.router}))},e}return Object(n.a)(a,[{key:"render",value:function(){var e=this;return Object(ke.jsx)(m.a,{in:!0,timeout:2e3,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",children:[Object(ke.jsx)(He,{}),Object(ke.jsx)(z.a,{height:"20%",children:Object(ke.jsx)(ge.a,{titleTypographyProps:{variant:"h3"},title:"Welcome"})}),Object(ke.jsxs)(z.a,{mx:"20%",display:"flex",height:"60%",flexDirection:"column",justifyContent:"space-evenly",style:{fontSize:20,textAlign:"center"},children:[Object(ke.jsx)(z.a,{position:"fixed",width:"40%",alignSelf:"center",fontSize:24,children:"Ruffmix is a tool for producers, musicians, and creators to share their works-in-progress and get feedback instantly."}),Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",mt:25,p:5,children:[Object(ke.jsx)(O.a,{variant:"outlined",className:this.props.router.getStyles("b_Introduction"),onClick:function(){return e.startMatch()},children:"Match Anonymously"}),Object(ke.jsx)(z.a,{mt:1}),Object(ke.jsx)(O.a,{variant:"outlined",className:this.props.router.getStyles("b_Introduction"),onClick:function(){return e.newAccount()},children:"Create New Account"})]})]}),Object(ke.jsx)(z.a,{height:"20%",mb:"1%",mr:"1%",display:"flex",flexDirection:"row-reverse",alignItems:"flex-end",children:Object(ke.jsx)(O.a,{variant:"outlined",endIcon:Object(ke.jsx)(We.a,{}),className:this.props.router.getStyles("b_MainWindow"),children:"How it works"})})]})})}}]),a}(u.a.Component),ct=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleChange=function(e){n.setState(Object(I.a)(Object(I.a)({},n.state),{},Object(be.a)({},e.target.name,e.target.value))),e.preventDefault()},n.handleLogin=function(e){v.auth().signInWithEmailAndPassword(n.state.username,n.state.password).then((function(e){console.log("User login success")})).catch((function(e){alert("Login fail"+e)})),e.preventDefault()},n.state={username:"",password:""},n.handleChange=n.handleChange.bind(Object(j.a)(n)),n.handleLogin=n.handleLogin.bind(Object(j.a)(n)),n}return Object(n.a)(a,[{key:"render",value:function(){var e=this;return Object(ke.jsx)(m.a,{in:!0,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[Object(ke.jsx)(ge.a,{title:"Login to Ruffmix"}),Object(ke.jsx)(z.a,{display:"flex",flexDirection:"column",className:this.props.router.getStyles("formContent"),children:Object(ke.jsx)("form",{onSubmit:this.handleLogin,children:Object(ke.jsxs)(z.a,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[Object(ke.jsx)(W.a,{label:"Email",name:"username",placeholder:". . .",size:"medium",type:"email",value:this.state.username,onChange:this.handleChange}),Object(ke.jsx)(W.a,{label:"Password",name:"password",placeholder:". . .",size:"medium",type:"password",value:this.state.password,onChange:this.handleChange}),Object(ke.jsx)(z.a,{mt:4,children:Object(ke.jsx)(O.a,{variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),type:"submit",children:"Log In"})})]})})}),Object(ke.jsx)(z.a,{display:"flex",flexDirection:"column",alignItems:"center",pb:4,children:Object(ke.jsx)(O.a,{variant:"outlined",className:this.props.router.getStyles("b_MainWindow"),onClick:function(){return e.props.router.updateContent(Object(ke.jsx)(at,{router:e.props.router}))},children:"Create New Account"})})]})})}}]),a}(u.a.Component),ot=function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(n.a)(a,[{key:"startMatch",value:function(){this.props.router.updateContent(Object(ke.jsx)(st,{router:this.props.router}))}},{key:"introduction",value:function(){this.props.router.updateContent(Object(ke.jsx)(it,{router:this.props.router}))}},{key:"login",value:function(){this.props.router.updateContent(Object(ke.jsx)(ct,{router:this.props.router}))}},{key:"accountView",value:function(){this.props.router.updateContent(Object(ke.jsx)(Me,{router:this.props.router,user:this.props.router.getUserID()}))}},{key:"accountSettings",value:function(){this.props.router.updateContent(Object(ke.jsx)(Le,{router:this.props.router,user:this.props.router.getUserID()}))}},{key:"uploadTrack",value:function(){this.props.router.getUserID()?this.props.router.updateContent(Object(ke.jsx)(Ce,{router:this.props.router})):this.login()}},{key:"browseUsers",value:function(){this.props.router.updateContent(Object(ke.jsx)(Fe,{router:this.props.router}))}},{key:"render",value:function(){var e=this;return Object(ke.jsxs)("body",{className:"header-bar",children:[Object(ke.jsxs)("div",{className:"header-left",children:[Object(ke.jsx)(O.a,{variant:"outlined",className:this.props.router.getStyles("b_AccentPrimary"),onClick:function(){return e.startMatch()},children:"match now"}),Object(ke.jsx)(y.a,{className:this.props.router.getStyles("divider"),orientation:"vertical"}),Object(ke.jsx)(O.a,{startIcon:Object(ke.jsx)(w.a,{}),variant:"outlined",className:this.props.router.getStyles("b_AccentSecondary"),onClick:function(){return e.uploadTrack()},children:"upload"}),Object(ke.jsx)(y.a,{className:this.props.router.getStyles("divider"),orientation:"vertical"}),Object(ke.jsx)(O.a,{variant:"outlined",className:this.props.router.getStyles("b_AccentSecondary"),onClick:function(){return e.browseUsers()},children:"browse users"})]}),Object(ke.jsx)(D.a,{color:"#inherit",component:"button",className:"header-center",onClick:function(){return e.introduction()},children:"ruffmix"}),Object(ke.jsxs)("div",{className:"header-right",children:[Object(ke.jsx)(Ae,{router:this.props.router,header:this}),Object(ke.jsx)("div",{hidden:""!==this.props.router.getUserID(),children:Object(ke.jsx)(O.a,{className:this.props.router.getStyles("b_AccentSecondary"),variant:"outlined",onClick:function(){return e.login()},children:"login"})}),Object(ke.jsx)("div",{hidden:""===this.props.router.getUserID(),children:Object(ke.jsx)(k.a,{className:this.props.router.getStyles("b_AccountCircle"),onClick:function(){return e.accountView()},children:Object(ke.jsx)(C.a,{})})})]})]})}}]),a}(u.a.Component),lt=(a(162),function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={content:Object(ke.jsx)(it,{router:Object(j.a)(n)}),prevContent:"",nextContent:"",userID:"",userDisplayName:"",refresh:!1,isLoading:!1,styleProvider:n.props.styleProviderClass,headerBar:Object(ke.jsx)(ot,{router:Object(j.a)(n)})},n.controllerRef=u.a.createRef(),n.updateContent=n.updateContent.bind(Object(j.a)(n)),n.goToPrevious=n.goToPrevious.bind(Object(j.a)(n)),n.getUserState=n.getUserState.bind(Object(j.a)(n)),n}return Object(n.a)(a,[{key:"getDimensions",value:function(){return this.controllerRef.current?this.controllerRef.current.offsetWidth:0}},{key:"getStyles",value:function(e){return this.state.styleProvider[e]}},{key:"getUserState",value:function(){return this.state.userState}},{key:"setLoadingState",value:function(e){this.setState({isLoading:e})}},{key:"setUser",value:function(e){var t=this;this.setState({userID:e.uid,userDisplayName:e.displayname},(function(){return t.refreshWindow()}))}},{key:"getUserID",value:function(){return this.state.userID}},{key:"getDisplayName",value:function(){return this.state.userDisplayName}},{key:"refreshWindow",value:function(){this.setState({refresh:!this.state.refresh,headerBar:Object(ke.jsx)(ot,{router:this})})}},{key:"signOut",value:function(){v.auth().signOut().then((function(){console.log("Signout success"),window.location.reload()})).catch((function(e){console.log("Signout fail: "+e)}))}},{key:"componentDidMount",value:function(){v.auth().onAuthStateChanged(function(e){var t=this;e&&!e.isAnonymous&&e&&this.setState({userID:e.uid,userDisplayName:e.displayname,content:Object(ke.jsx)(Me,{user:e.uid,router:this})},(function(){return t.refreshWindow()})),e||(console.log("User logout"),this.setState({content:Object(ke.jsx)(it,{router:this})},(function(){return t.refreshWindow()})))}.bind(this))}},{key:"updateContent",value:function(e){var t=this;this.setState({content:null},(function(){t.setState({content:e})}))}},{key:"goToPrevious",value:function(){this.setState({content:this.state.prevContent})}},{key:"render",value:function(){this.props.className;return Object(ke.jsxs)("div",{children:[Object(ke.jsx)(p.a,{style:{zIndex:"10"},open:this.state.isLoading,children:Object(ke.jsxs)(f.a,{style:{width:"20%",height:"20%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-evenly"},children:[Object(ke.jsx)(b.a,{}),"Loading . . ."]})}),this.state.headerBar,Object(ke.jsx)(m.a,{in:!0,timeout:2e3,children:Object(ke.jsx)(f.a,{elevation:3,className:"main-window-card",children:this.state.content})})]})}}]),a}(u.a.Component)),ut=(a(163),a(20)),dt=a(222),ht=a(223),jt="#2f3847",pt=Object(ut.a)(dt.a[500],.15),ft={b_AccentPrimary:{color:ht.a[500],borderColor:"rgb(1,1,1,0)","&:hover":{borderColor:ht.a[500]}},b_AccentSecondary:{color:dt.a[300],borderColor:"rgb(1,1,1,0)","&:hover":{borderColor:dt.a[300]}},b_Introduction:{color:jt,borderColor:dt.a[300],"&:hover":{borderColor:ht.a[500]}},b_MainWindow:{color:jt,borderColor:"#fff",backgroundColor:dt.a[50],"&:hover":{borderColor:ht.a[500],backgroundColor:dt.a[50]}},b_AccountCircle:{color:dt.a[300],"&:hover":{backgroundColor:pt}},b_MenuIcon:{color:dt.a[300],"&:hover":{backgroundColor:pt}},divider:{marginTop:"10px",marginBottom:"10px",marginRight:"10px",marginLeft:"10px",backgroundColor:dt.a[300],"&.MuiDivider-vertical":{marginTop:0,marginBottom:0}},headerMenu:{color:dt.a[300],backgroundColor:jt,marginTop:"14px",marginRight:"3px","& .MuiMenuItem-root":{"&:hover":{backgroundColor:pt}}},formContent:{"& .MuiFormControl-root":{marginTop:"10px",marginBottom:"10px"}},secondary:{color:dt.a[300]},mainBackground:{zIndex:0,width:"60%",height:"70%",position:"absolute",top:0,left:0,right:0,bottom:0,margin:"auto",borderColor:jt}},bt=a(127),mt=Object(bt.a)({palette:{primary:{main:ht.a[600]},secondary:{main:"#2f3847"}},overrides:{MuiButton:{root:{textTransform:"none",fontSize:18,fontFamily:["Century Gothic, Futura, sans-serif"].join()}},MuiMenuItem:{root:{textTransform:"none",fontSize:18,fontFamily:["Century Gothic, Futura, sans-serif"].join(),justifyContent:"flex-end"}},MuiTooltip:{arrow:{color:"#2f3847"},tooltip:{textAlign:"center",color:dt.a[300],backgroundColor:"#2f3847",fontSize:18,fontFamily:["Century Gothic, Futura, sans-serif"].join()}}}}),gt=(u.a.Component,function(e){Object(s.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).state={},n._isMounted=!1,n}return Object(n.a)(a,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"render",value:function(){var e=this.props.classes;return Object(ke.jsx)("div",{children:Object(ke.jsx)("main",{className:"main-panel",children:Object(ke.jsx)("div",{children:Object(ke.jsx)(lt,{styleProviderClass:e})})})})}}]),a}(u.a.Component)),xt=Object(c.a)(ft)(gt);h.a.render(Object(ke.jsx)(o.a,{theme:mt,children:Object(ke.jsx)(xt,{})}),document.getElementById("root"))}},[[164,1,2]]]);
//# sourceMappingURL=main.c5824059.chunk.js.map